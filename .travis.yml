language: node_js

jobs:
  fast_finish: true
  allow_failures:
    - stage: security scan ğŸ”

  include:
    - stage: unit tests ğŸ‘©ğŸ½â€ğŸ’»
      script: npm run test:unit
      node_js: lts/*

    - stage: spec tests ğŸ‘©ğŸ½â€ğŸ’»
      script: npm run test:specs
      node_js: lts/*
    - node_js: node

    - stage: lint âœ¨
      script: npm run test:lint
      node_js: lts/*

    - stage: build ğŸ—œï¸
      script: |
        npm run build
        if ! git diff --quiet; then
          git config --global user.email "<>"
          git config --global user.name "MarkedJS bot"
          git config credential.helper "store --file=.git/credentials"
          echo "https://${GITHUB_TOKEN}:@github.com" > .git/credentials
          git commit -am 'ğŸ—œï¸ build [skip ci]'
          git push origin HEAD:${TRAVIS_BRANCH}
        fi
      node_js: lts/*
      if: branch = master AND type = push

    # - stage: security scan ğŸ”
    #   script: npm run test:redos
    #   node_js: lts/*

cache:
  directories:
    - node_modules

git:
  depth: 3
